<!DOCTYPE html>
<html data-theme="adocasts-{{ theme }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    @if ($slots.meta)
      {{{ await $slots.meta() }}}
    @endif

    @if (meta)
      @!meta.tags({ ...meta, title })
    @endif

    @if (!$slots.meta && !meta?.title)
      <title>
        {{ env('APP_BRAND') }}
      </title>
    @endif

    <script>
      // set system color scheme preference
      const updateColorScheme = (e) => {
        const isDark = e.matches ?? window.matchMedia('(prefers-color-scheme: dark)').matches;
        document.documentElement.setAttribute('prefers-color-scheme', isDark ? 'dark' : 'light');
        document.documentElement.dataset.theme = isDark ? 'adocasts-dark' : 'adocasts-light'
      };

      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');

      updateColorScheme(mediaQuery);

      if (typeof mediaQuery.addEventListener === 'function') {
        mediaQuery.addEventListener('change', updateColorScheme);
      } else {
        mediaQuery.addListener(updateColorScheme);
      }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&family=Red+Hat+Mono:ital,wght@0,300..700;1,300..700&display=swap" rel="stylesheet">
    <script defer data-domain="adocasts.com" src="https://analytics.adocasts.com/js/plausible.js"></script>

    @vite(['resources/css/app.css', 'resources/js/app.js'])
    @stack('dumper')

    @if (env('TURNSTILE_ENABLED'))
      <script src="https://challenges.cloudflare.com/turnstile/v0/api.js"></script>
    @endif
  </head>
  <body class="max-w-[120rem] mx-auto flex flex-col" {{ html.attrs({ style: $props.style }) }} data-show-transcript="{{ showTranscript }}">
    <div id="context" x-data="{ state: {} }" @mounted="state = { ...state, [$event.detail.name]: $event.detail.data }" @call="state[$event.detail.namespace][$event.detail.name]($event.detail.args)"></div>
    <div id="portal"></div>

    @if ($slots.header)
      {{{ await $slots.header() }}}
    @else
      @!header()
    @endif

    <div up-main x-data x-init="window.isAuthenticated = {{ !!auth?.user }}" class="flex-1 flex">
      {{{ await $slots.main() }}}
    </div>

    @if ($slots.footer)
      {{{ await $slots.footer() }}}
    @else
      @!footer()
    @endif

    @!toast()

    <div id="banners" up-hungry>
      @!banner.verifyEmail()
    </div>

    <div up-modal-fragment></div>
    <div up-pricing>
      @if (isPricingPage)
        <script src='https://cdn.paritydeals.com/banner.js'></script>
      @endif
    </div>

    @stack('modals')
  </body>
</html>
