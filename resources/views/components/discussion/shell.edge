@let(defaultFeed = request.ctx.route?.name !== 'discussions.index' ? null : 'none')
@let(feed = filters?.feed ?? defaultFeed)
@let(feedTitles = new Map([
  ['none', 'All discussions'],
  ['noreplies', 'No replies'],
  ['unsolved', 'Unsolved'],
  ['solved', 'Solved'],
]))

@layout.shell.asideLeft({
  overflow: true,
  main: {
    id: 'discussionList',
    class: 'flex flex-col gap-3 lg:gap-6'
  }
})
  @slot('aside')

    @if ($slots.actions)
      {{{ await $slots.actions() }}}
    @else
      @if (auth.user)
        <a href="{{ route('discussions.create') }}" class="btn btn-outline btn-primary btn-block mb-3">
          @svg('solar:chat-round-line-outline', { class: 'size-5' })
          New Discussion
        </a>
      @else
        <a href="{{ route('auth.signup') }}" class="btn btn-outline btn-primary btn-block mb-3" up-auth-modal>
          @svg('solar:chat-round-line-outline', { class: 'size-5' })
          New Discussion
        </a>
      @endif
    @endif

    <form method="GET" action="{{ route('discussions.index') }}" up-target="#discussionList" up-autosubmit="true" up-focus="keep">
      <div class="mb-3 md:mb-6">
        @form.field({ name: 'pattern', as: 'div', class: 'w-full' })
          @form.input({ type: 'search', value: filters?.pattern, placeholder: 'Search discussions ...', class: 'w-full', 'up-watch-delay': 500 })
            @slot('prefix')
              @svg('solar:minimalistic-magnifer-outline')
            @endslot
          @end
        @end
      </div>

      <div class="mb-3">
        <ul x-data="{ feed: {{ js.stringify(feed) }} }" class="menu w-full gap-0.5 p-0 text-sm">
          <li>
            @!form.select.radio({
              name: 'feed',
              value: 'none',
              text: feedTitles.get('none'),
              icon: 'solar:chat-round-call-outline',
              '@click': `document.getElementById('my-aside-drawer').checked = false`
            })
          </li>
          <li>
            @!form.select.radio({
              name: 'feed',
              value: 'noreplies',
              text: feedTitles.get('noreplies'),
              icon: 'solar:chat-round-unread-outline',
              '@click': `document.getElementById('my-aside-drawer').checked = false`
            })
          </li>
          <li>
            @!form.select.radio({
              name: 'feed',
              value: 'unsolved',
              text: feedTitles.get('unsolved'),
              icon: 'solar:chat-round-dots-outline',
              '@click': `document.getElementById('my-aside-drawer').checked = false`
            })
          </li>
          <li>
            @!form.select.radio({
              name: 'feed',
              value: 'solved',
              text: feedTitles.get('solved'),
              icon: 'solar:chat-round-check-outline',
              '@click': `document.getElementById('my-aside-drawer').checked = false`
            })
          </li>
        </ul>
      </div>

      @collapse.filter({ title: 'Topic', class: 'collapse-arrow !px-0', open: true })
        @each (topic in topics)
          @!form.checkbox({ 
            name: 'topics[]', 
            label: topic.name, 
            value: topic.slug, 
            class: 'checkbox checkbox-xs',
            checked: filters?.topics?.includes(topic.slug),
            fade: true 
          })
        @endeach
      @end
    </form>

  @endslot

  {{{ await $slots.main({ feed, feedTitles }) }}}
@end
